---
slug: nextjs-environment-variable-support-and-the-envlocal-file
date: '2023-02-19T12:04:21.055Z'
lastModified: '2023-02-19T12:56:21.055Z'
title: Next.js Environment Variable Support and the .env.local File
author: Maria D. Campbell
excerpt: Next.js environment variable support and the .env.local file.
image: neil-thomas-SIU1Glk6v5k-unsplash.jpg
tags: ['nextjs', 'environment variables', 'fullstack development']
isPublished: true
isFeatured: true
---

![Tree supported by large wooden hand](neil-thomas-SIU1Glk6v5k-unsplash.jpg)

*Photo by [Neil Thomas](https://unsplash.com/@finleydesign) on [Unsplash](https://unsplash.com/photos/SIU1Glk6v5k)*

***Previously***, I had ***written*** a `post` about ***using*** `dotenv` with `Next.js`, and ***also adding*** the `NEXT_PUBLIC` ***prefix*** in ***front*** of `environment variable` ***names***. ***Adding*** `NEXT_PUBLIC` and then ***placing*** `process.env` ***in front*** of the `environment variable` ***name*** and ***using*** it ***directly*** like that in your code will ***expose*** it to the `browser`. And you ***have*** to ***add*** `NEXT_PUBLIC` in ***order*** for ***that*** to ***happen***.  So ***something*** like the ***following***:

```js
const data = { email, api_key: process.env.NEXT_PUBLIC_CONVERTKIT_API_KEY }
```

would be ***exposed*** to the `browser`. ***However***, the ***following***:

```js
const API_KEY = process.env.NEXT_PUBLIC_CONVERTKIT_API_KEY
const data = { email, api_key: API_KEY }
```

***would not***, ***because*** it is ***saved*** as the `value` of a `variable`. And ***that*** is the ***way*** I have ***always*** ***approached*** my `environment variables`, ***especially*** when using `dotenv`. ***Which*** is ***what*** I ***do*** in the ***case*** of my `business site`. ***However***, I ***found out*** later, that ***this*** is `redundant`. It is ***not necessary*** to ***use*** `dotenv` in ***order*** to ***be able*** to ***extract*** one’s `environment variable` ***values*** from the `.env.local` ***file***. It is ***important*** to ***note*** that you ***have*** to ***save*** your `environment variables` in your `.env.local` ***file***. ***That*** is ***where*** `Next.js` ***expects*** you to ***keep*** your `secrets`. It is ***also*** (***most***) ***important*** to ***note*** that you ***have*** to ***add*** your `.env.local` ***file*** to your `.gitignore` ***file*** ***immediately*** `upon creation` of your ***project*** ***before*** having `committed` and `pushed` any ***changes*** to ***remote***. This is ***both*** so you ***don't forget*** to do so ***later***, and to ***ensure*** that your `sensitive information` ***stored*** as the `values` of your `variables` are ***never exposed*** on `Github` or ***wherever else***. `Next.js'` `create-next-app` ***does create*** a `.gitignore` ***file*** for you, and ***does include*** the `.env*.local` file ***there*** for you, ***but*** if you are ***new*** to ***all this***, it is ***good practice*** to ***double check*** the ***file***. The `.env` ***file*** is NOT ***added there***. That is ***meant*** for ***non-sensitive***, ***default*** `env var` ***values***, and ***therefore*** does ***not need*** to be ***included*** in `.gitignore`.

Then I was ***introduced*** to `Next.js phases`, which ***refers*** to the ***various*** `phases` one can ***have*** in ***development***. There are ***numerous ones*** one `can use` in `Next.js`, and you can ***view*** the ***available*** `phases` on the `Next.js` ***Github*** `repository` here: [constants.ts](https://github.com/vercel/next.js/blob/5e6b008b561caf2710ab7be63320a3d549474a5b/packages/next/shared/lib/constants.ts#L19-L23)

***For example***, in my `Next blog` I ***built*** (and ***still adding*** some ***more features***, like a `guestbook page` ***built*** with `MongoDB` (`Atlas`) for ***storing*** `user messages` on a `“guestbook”` ***page***, I ***added*** `phases` in my `next.config.js` ***file*** like the ***following***:

```js
const { PHASE_DEVELOPMENT_SERVER } = require('next/constants')

const withBundleAnalyzer = require('@next/bundle-analyzer')({
	enabled: process.env.ANALYZE === 'true',
	function(phase) {
		if (phase === PHASE_DEVELOPMENT_SERVER) {
			return {
				env: {
					mongodb_username: `${MONGODB_USERNAME}`,
					mongodb_password: `${MONGODB_PASSWORD}`,
					mongodb_clusername: `${MONGODB_CLUSTERNAME}`,
					mongodb_database: `${MONGODB_DATABASE_DEV}`
				}
			}
		}
		return {
			env: {
				mongodb_username: `${MONGODB_USERNAME}`,
				mongodb_password: `${MONGODB_PASSWORD}`,
				mongodb_clusername: `${MONGODB_CLUSTERNAME}`,
				mongodb_database: `${MONGODB_DATABASE}`
			}
		}
	},
/** @type {import('next').NextConfig} */
const nextConfig = {
	/* Configure pageExtensions to include md and mdx */
	pageExtensions: ['ts', 'tsx', 'js', 'jsx', 'md', 'mdx'],
	/* Optionally, add any other Next.js config below */
	reactStrictMode: true,
}

module.exports = withBundleAnalyzer(nextConfig)
```

In ***order*** to ***use*** the `development phase` ***environment variables***, ***just run*** `npm run dev`. And ***when*** you ***run*** `npm start` ***after*** `npm run build` for `production`, the `production` ***environment variables*** will be ***used***.

***No need*** to `require` and `call` `dotenv` as I ***had done*** in the ***past***. This was ***not wrong***, but it means ***one less dependency*** to ***include***. I just ***added*** the `phases`. But then I ***still had*** to ***add*** my `environment variables` for `production` to my `project` on `vercel.com`. ***That*** is ***because*** I did ***not*** `directly` ***add*** the ***actual values*** for my `MongoDB` `username`, `password`, `cluster`, and `database` in `next.config.js`, which ***would have*** been ***stupid***! if you ***set*** your `Github` (or ***whichever***) `remote repo` to ***private***, ***that*** is ***fine***. But ***perhaps*** you ***don't want*** it to be `private` for ***whichever reason***. If I had ***not done*** that and ***used*** the `environment vairables` ***instead*** (as ***shown above***), thereby ***protecting*** the `sensitive information`, then I would ***not have*** to ***set*** my `Github` ***repository*** to `private` (if I did ***not want*** to ***set*** it to `private`). ***However***, if `dotenv` is your ***preference***, you can ***stick*** with that ***too***. But ***why*** do that if you ***don't*** have to?

The `Next.js` ***documentation*** regarding `support` for `environment variables` is ***pretty good***, and if you ***already*** have been ***using*** `environment variables` with `dotenv` in your `Node.js` ***projects*** in the ***past***, it will be ***fairly easy*** to ***follow***. I will be ***including*** `reference` to the `Next.js` ***documentation*** at the ***end*** of the `post` ***under*** `Related Resources`.

*Happy Next.js phasing!*

## Related Resources

- [next.config.js](https://nextjs.org/docs/api-reference/next.config.js/introduction): Next.js documentation

- [Environment Variables](https://nextjs.org/docs/basic-features/environment-variables)
